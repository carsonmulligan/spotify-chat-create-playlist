<!-- public/landing.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TuneSmith - AI-Powered Spotify Playlist Creator</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>TuneSmith ðŸŽµ</h1>
            <nav>
                <a href="/login" class="button">Try it out with Spotify</a>
            </nav>
        </header>

        <main>
            <section class="hero">
                <h2>AI-Powered Spotify Playlist Creator ðŸ¤–ðŸŽ§</h2>
                <p>Create the perfect playlist with just a few words! âœ¨</p>
                <p>Get 3 free playlists, then $2.99 per month for unlimited access.</p>
                <a href="/login" class="button">Try it out with Spotify</a>
                <button id="subscribe-button" class="button">Subscribe Now</button>
            </section>

            <section class="demo">
                <h3>See TuneSmith in Action ðŸŽ¬</h3>
                <video width="100%" controls>
                    <source src="/tunesmith_product_demo.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </section>

            <section class="features">
                <h3>Features ðŸš€</h3>
                <ul>
                    <li>ðŸ§  AI-powered playlist generation</li>
                    <li>ðŸŽµ Seamless Spotify integration</li>
                    <li>ðŸŽ¨ Customizable playlists</li>
                    <li>âš¡ Quick and easy to use</li>
                </ul>
            </section>
        </main>

        <footer>
            <p>&copy; 2024 TuneSmith. All rights reserved.</p>
        </footer>
    </div>
    <script src="https://js.stripe.com/v3/"></script>
    <script>
        document.getElementById('subscribe-button').addEventListener('click', async () => {
            try {
                // Check if user is authenticated
                const authResponse = await fetch('/check-auth');
                const authData = await authResponse.json();
                if (!authData.authenticated) {
                    // Redirect to Spotify login
                    window.location.href = '/login';
                    return;
                }

                // Fetch Stripe publishable key
                const configResponse = await fetch('/config');
                const configData = await configResponse.json();
                const stripe = Stripe(configData.publishableKey);

                const response = await fetch('/create-checkout-session', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                if (!response.ok) {
                    throw new Error('Failed to create checkout session');
                }

                const session = await response.json();
                const result = await stripe.redirectToCheckout({
                    sessionId: session.id,
                });

                if (result.error) {
                    throw result.error;
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to start subscription process. Please try again.');
            }
        });
    </script>
</body>
</html>
